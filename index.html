<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ¥é€±ã®é£Ÿæã‚¹ãƒˆãƒƒã‚¯è¨ˆç®—</title>

  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#111111">

  <style>
    :root { --bg:#f6f7fb; --card:#fff; --text:#111; --muted:#666; --line:#e6e8f0; }
    body {
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header {
      padding:14px 16px;
      font-weight:800;
      background:#111;
      color:#fff;
      position:sticky;
      top:0;
      z-index:5;
    }
    main {
      max-width: 980px;
      margin: 0 auto;
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .card {
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      box-shadow: 0 2px 8px rgba(0,0,0,.04);
    }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    label { font-size: 13px; color: var(--muted); }
    select, input[type="number"] {
      padding:10px;
      border:1px solid var(--line);
      border-radius:12px;
      font-size:14px;
      background:#fff;
    }
    button {
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
      font-weight:700;
      cursor:pointer;
    }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.danger { color:#b00020; border-color:#f0c2c7; }
    .small { font-size:12px; color:var(--muted); }
    .divider { height:1px; background:var(--line); margin:10px 0; }
    .grid {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 10px;
    }
    .ing {
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
    }
    .ing .left { display:flex; gap:8px; align-items:center; }
    .pill {
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
    }
    .qty { font-weight:800; }
    .recipeRow {
      border:1px dashed var(--line);
      border-radius:14px;
      padding:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .recipeRow select { min-width: 240px; }
    .rightGrow { flex: 1 1 auto; }
  </style>
</head>

<body>
<header>æ¥é€±ã®é£Ÿæã‚¹ãƒˆãƒƒã‚¯è¨ˆç®—</header>

<main>

  <section class="card">
    <div class="row" style="justify-content:space-between;">
      <div>
        <div style="font-weight:800; font-size:16px;">æ¡ä»¶</div>
        <div class="small">
          1æ—¥3é£Ÿå‰æã§ã€ä½œã‚‹é£Ÿæ•°ã‹ã‚‰å¿…è¦ãªé£Ÿæã‚¹ãƒˆãƒƒã‚¯ã‚’è¨ˆç®—ã—ã¾ã™
        </div>
      </div>
      <div class="pill">1æ—¥ï¼3é£Ÿ</div>
    </div>

    <div class="divider"></div>

    <div class="row">
      <div>
        <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆè¤‡æ•°å¯ï¼‰</label><br>
        <select id="categories" multiple size="3">
          <option value="curry">ã‚«ãƒ¬ãƒ¼ãƒ»ã‚·ãƒãƒ¥ãƒ¼</option>
          <option value="salad">ã‚µãƒ©ãƒ€</option>
          <option value="dessert">ãƒ‡ã‚¶ãƒ¼ãƒˆãƒ»ãƒ‰ãƒªãƒ³ã‚¯</option>
        </select>
      </div>

      <div class="rightGrow"></div>

      <button id="addRecipe" class="primary">æ–™ç†ã‚’è¿½åŠ </button>
      <button id="clearAll" class="danger">å…¨éƒ¨ã‚¯ãƒªã‚¢</button>
    </div>

    <div id="recipeList" style="margin-top:10px;"></div>
  </section>

  <section class="card">
    <div style="font-weight:800;">ä»¥ä¸‹ã®é£Ÿæã¯è¨ˆç®—ã‹ã‚‰é™¤å¤–ã™ã‚‹</div>
    <div class="small">ãƒã‚§ãƒƒã‚¯ã—ãŸé£Ÿæã¯å¿…è¦ã‚¹ãƒˆãƒƒã‚¯ã‚’0ã¨ã—ã¦æ‰±ã„ã¾ã™</div>
    <div class="grid" id="excludeGrid"></div>
  </section>

  <section class="card">
    <div style="font-weight:800;">ä»¥ä¸‹ã®é£Ÿæã¯1æ—¥å½“ãŸã‚Šâ˜†å€‹è£œå®Œå¯èƒ½ã¨ä»®å®šã™ã‚‹</div>
    <div class="small">ï¼ˆåˆè¨ˆé£Ÿæ•° Ã· 3æ—¥ï¼‰Ã— â˜†å€‹ ã‚’æ¸›ç®—ã—ã¾ã™</div>
    <div class="grid" id="replenishGrid"></div>
  </section>

  <section class="card">
    <div class="row" style="justify-content:space-between;">
      <div>
        <div style="font-weight:800;">è¨ˆç®—çµæœ</div>
        <div id="summary" class="small"></div>
      </div>
      <button id="calc" class="primary">è¨ˆç®—ã™ã‚‹</button>
    </div>

    <div class="divider"></div>
    <div id="resultGrid" class="grid"></div>
  </section>

</main>

<script>
/* ===============================
   ãƒ‡ãƒ¼ã‚¿å®šç¾©
=============================== */

const MEALS_PER_DAY = 3;

const INGREDIENTS = [
  {id:"avocado", name:"ã¤ã‚„ã¤ã‚„ã‚¢ãƒœã‚«ãƒ‰", icon:"ğŸ¥‘"},
  {id:"potato", name:"ã»ã£ã“ã‚Šãƒãƒ†ãƒˆ", icon:"ğŸ¥”"},
  {id:"milk", name:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼ãƒŸãƒ«ã‚¯", icon:"ğŸ¥›"},
  {id:"oil", name:"ãƒ”ãƒ¥ã‚¢ãªã‚ªã‚¤ãƒ«", icon:"ğŸ›¢ï¸"}
];

const RECIPES = [
  {
    id:"shiny_avocado_gratin",
    category:"curry",
    name:"ã—ã‚“ã‚Šã‚‡ãã‚¢ãƒœã‚«ãƒ‰ã‚°ãƒ©ã‚¿ãƒ³",
    ingredients: { avocado:22, potato:20, milk:41, oil:32 }
  }
];

const el = (id) => document.getElementById(id);

const state = { recipeRows: [] };

/* ===============================
   UIç”Ÿæˆ
=============================== */

function recipeOptionsHTML() {
  let html = `<option value="">æ–™ç†ã‚’é¸æŠâ€¦</option>`;
  for (const r of RECIPES) {
    html += `<option value="${r.id}">${r.name}</option>`;
  }
  return html;
}

function addRecipeRow(initial={recipeId:"", meals:1}) {
  const rowId = crypto.randomUUID();
  state.recipeRows.push({rowId, ...initial});

  const wrap = document.createElement("div");
  wrap.className = "recipeRow";

  wrap.innerHTML = `
    <select class="recipeSel">${recipeOptionsHTML()}</select>
    <select class="mealsSel">
      ${Array.from({length:21},(_,i)=>`<option>${i+1}</option>`).join("")}
    </select>
    <span class="pill">é£Ÿ</span>
    <button class="removeBtn danger">å‰Šé™¤</button>
  `;

  const recipeSel = wrap.querySelector(".recipeSel");
  const mealsSel = wrap.querySelector(".mealsSel");

  recipeSel.value = initial.recipeId;
  mealsSel.value = initial.meals;

  recipeSel.onchange = () => {
    state.recipeRows.find(r=>r.rowId===rowId).recipeId = recipeSel.value;
  };
  mealsSel.onchange = () => {
    state.recipeRows.find(r=>r.rowId===rowId).meals = Number(mealsSel.value);
  };
  wrap.querySelector(".removeBtn").onclick = () => {
    state.recipeRows = state.recipeRows.filter(r=>r.rowId!==rowId);
    wrap.remove();
  };

  el("recipeList").appendChild(wrap);
}

function renderExcludeAndReplenish() {
  const ex = el("excludeGrid");
  const rep = el("replenishGrid");
  ex.innerHTML = "";
  rep.innerHTML = "";

  for (const ing of INGREDIENTS) {
    ex.innerHTML += `
      <div class="ing">
        <label><input type="checkbox" class="exChk" data-iid="${ing.id}">
        ${ing.icon} ${ing.name}</label>
      </div>
    `;

    rep.innerHTML += `
      <div class="ing">
        <label>
          <input type="checkbox" class="repChk" data-iid="${ing.id}">
          ${ing.icon} ${ing.name}
        </label>
        <input type="number" class="repQty" data-iid="${ing.id}" value="0" min="0" max="999">
      </div>
    `;
  }
}

/* ===============================
   è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ ¸å¿ƒï¼‰
=============================== */

function calc() {
  let totalMeals = 0;
  const need = new Map();

  for (const row of state.recipeRows) {
    if (!row.recipeId) continue;
    const recipe = RECIPES.find(r=>r.id===row.recipeId);
    totalMeals += row.meals;

    for (const [iid, perMeal] of Object.entries(recipe.ingredients)) {
      need.set(iid, (need.get(iid)||0) + perMeal * row.meals);
    }
  }

  const days = totalMeals / MEALS_PER_DAY;

  document.querySelectorAll(".repChk:checked").forEach(chk => {
    const iid = chk.dataset.iid;
    const perDay = Number(document.querySelector(`.repQty[data-iid="${iid}"]`).value||0);
    need.set(iid, Math.max(0, (need.get(iid)||0) - perDay * days));
  });

  document.querySelectorAll(".exChk:checked").forEach(chk => {
    need.set(chk.dataset.iid, 0);
  });

  el("summary").textContent = `åˆè¨ˆ ${totalMeals}é£Ÿï¼ˆ${days}æ—¥æ›ç®— / 1æ—¥3é£Ÿï¼‰`;

  const out = el("resultGrid");
  out.innerHTML = "";
  for (const ing of INGREDIENTS) {
    const v = Math.round(need.get(ing.id)||0);
    if (v>0) {
      out.innerHTML += `
        <div class="ing">
          <div class="left">${ing.icon} ${ing.name}</div>
          <div class="qty">${v}å€‹</div>
        </div>
      `;
    }
  }
}

/* ===============================
   åˆæœŸåŒ–
=============================== */

el("addRecipe").onclick = () => addRecipeRow();
el("clearAll").onclick = () => location.reload();
el("calc").onclick = calc;

renderExcludeAndReplenish();
addRecipeRow({recipeId:"shiny_avocado_gratin", meals:12});
</script>

<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./service-worker.js");
  });
}
</script>

</body>
</html>
